<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="assets/css/tulip.css">
    <link rel="stylesheet" href="assets/libs/foundation-5.5.3/css/foundation.css" />
    <link rel="stylesheet" href="assets/css/foundation-icons/foundation-icons.css" />
    <title>tulip</title>
  </head>
  <body class="off-canvas-wrap" data-offcanvas>
    <img id="loading" src="./assets/tulip-logo3.png" style="width:300px">
    <!-- top navigation tools -->
    <main class="inner-wrap" style="height:100%">
    <!-- START NAV -->
    <nav class="top-bar" data-topbar role="navigation">
      <!-- map Section -->
      <ul class="left">
        <li>
          <a href="#" class="button tiny radius secondary" id="zin"><i class="fi-plus"></i></a>
          <a href="#" class="button tiny radius secondary" id="zout"><i class="fi-minus"></i></a>
        </li>
      </ul>
      <ul class="left">
        <li>
          <a href="#" class="button dropdown tiny radius secondary" data-dropdown="layers-dropdown" aria-controls="drop1" aria-expanded="false" id="map-layers">
            <i class="fi-map"></i>
          </a>
          <ul id="layers-dropdown" data-dropdown-content class="f-dropdown" aria-hidden="true">
            <li><a href="#" id="map-hybrid-layer" class="selected" >Hybrid <i class="fi-check"></i></a></li>
            <li><a href="#" id="map-satellite-layer">Satellite <i class="fi-check hide"></i></a></li>
            <li><a href="#" id="map-roadmap-layer">Roadmap <i class="fi-check hide"></i></a></li>
            <li><a href="#" id="map-terrain-layer">Terrain <i class="fi-check hide"></i></a></li>
          </ul>
        </li>
      </ul>
      <ul class="left">
        <li>
          <span data-tooltip aria-haspopup="true" class="map-rotate-notice has-tip button tiny radius alert" style="display: none;" title="Map interaction other than zoom is disabled when map is rotated.">
            <i class="fi-alert"></i>
          </span>
          <a href="#" class="button tiny radius secondary" id="draw-route" data-tooltip aria-haspopup="true" title="When enabled prevents adding points on map click">
            <i class="fi-lock"></i>
          </a>
          <!-- maybe reourpose for snap to -->
          <!-- <a href="#" class="button tiny radius secondary" id="remove-route" data-tooltip aria-haspopup="true" title="When enabled clicking on one point then another removes all points in between.">
            <i class="fi-x-circle"></i>
          </a> -->
        </li>
      </ul>
    </nav>
    <!-- END NAV -->
    <!--  START ADVANCED MENU -->
    <aside class="right-off-canvas-menu">
        <h2>
          Menu:
        </h2>
        <ul>
          <li><a href="#" id="new-roadbook" class="main-menu button tiny radius info"><i class="fi-compass"></i> New Roadbook</a></li>
          <li><a href="#" id="open-roadbook" class="main-menu button tiny radius info"><i class="fi-folder"></i> Open Roadbook</a></li>
          <hr>
          <li><a href="#" id="import-gpx" class="main-menu button tiny radius"><i class="fi-download"></i> Import GPX</a></li>
          <li><a href="#" id="export-gpx" class="main-menu button tiny radius"><i class="fi-map"></i> Export GPX</a></li>
          <li><a href="#" id="print-roadbook" class="main-menu button tiny radius"><i class="fi-print"></i> Export PDF</a></li>
          <hr>
        </ul>
    </aside>
    <!--  END ADVANCED MENU -->
    <!--  START CONTENT -->
    <div id="content">
      <div class="content-container">
        <!-- <div class='map-container column' > -->
          <div id="map">
          </div>
        <!-- </div> -->
        <div class='roadbook-container collapsed'>
          <div class="row" id="roadbook-header">
            <div class="large-3 columns title">
              Tulip
            </div>
            <div class="large-5 columns menu">
              <a href="#" class="button tiny radius secondary" id="save-roadbook" data-tooltip aria-haspopup="true" class="has-tip button tiny radius alert" title="Click to save. Shift+click to 'Save as'">
                <i class="fi-save"></i>
              </a>
              <a href="#" class="button tiny radius secondary" id="toggle-roadbook"><i class="fi-arrow-down"></i></a>
              <a href="#" class="button tiny radius secondary right-off-canvas-toggle" id="main-menu"><i class="fi-list"></i></a>
            </div>
          </div>
          <div id="roadbook">
            <div class="row roadbook-info">
              <hr>
              <div id="roadbook-total-distance" class="large-4 columns">
                Total Kilometers:
                <p data-bind="text: app.roadbook.totalDistance"></p>
              </div>
              <div id="roadbook-name" class="large-8 columns">
                <a class="button tiny round alert hide-editor" title="Hide editor.">&#215;</a>
                <a href=# class="button tiny radius secondary show-editor rb-name"><i class="fi-pencil"></i></a>
                <p href="#" data-bind="text: app.roadbook.name"></p>
                <div class="roadbook-header-input-container">
                  <input type="text" placeholder="Roadbook Name" data-bind="textInput: app.roadbook.name"/>
                </div>
              </div>
            </div>
            <div class="row roadbook-info">
              <hr>
              <div id="roadbook-desc" class="large-12 columns">
                <a class="button tiny round alert hide-editor rb-desc" title="Hide editor.">&#215;</a>
                <a href=# class="button tiny radius secondary show-editor rb-desc"><i class="fi-pencil"></i></a>
                <p data-bind="html: app.roadbook.desc"></p>
                <div class="roadbook-header-input-container">
                  <div id="description-toolbar">
                    <select class="ql-size" style="width:25%">
                      <option value="10px">Small</option>
                      <option value="13px" selected>Normal</option>
                      <option value="18px">Large</option>
                      <option value="32px">Huge</option>
                    </select>
                    <!-- Add a bold button -->
                    <button class="ql-bold tiny secondary"><i class="fi-bold"></i></button>
                    <button class="ql-italic tiny secondary "><i class="fi-italic"></i></button>
                    <button class="ql-underline tiny secondary"><i class="fi-underline"></i></button>
                  </div>
                  <div id="description-editor"></div>
                </div>
                <hr>
              </div>
            </div>
            <!-- render instruction templates here -->
            <div id="roadbook-waypoints" data-bind="template: { name: 'waypoint-template', foreach: app.roadbook.instructions }"></div>
            <!--  palette for editing instruction content -->
            <div id="waypoint-palette">
              <div class="row">
                <div class="large-12 columns text-right">
                  <span data-tooltip aria-haspopup="true" class="map-rotate-notice has-tip button tiny radius alert" style="display: none;" title="Map interaction other than zoom is disabled when map is rotated.">
                    <i class="fi-alert"></i>
                  </span>
                  <a id="orient-map" class="button tiny round success" title="Orient map with tulip"><i class="fi-compass"></i></a>
                  <a id="hide-palette" class="button tiny round alert" title="Hide palette.">&#215;</a>
                </div>
              </div>
              <div id="waypoint-tulip-controls" class="content active">
                <div class="row">
                  <div class="large-4 columns selection-label">
                    <h5>
                      <span data-tooltip aria-haspopup="true" class="has-tip track-selection" title="Select the type of tracks added to the tulip, the track type the rider will enter the tulip on, and the track type the rider will exit the tulip on.">
                        Tulip track types
                      </span>
                    </h5>
                  </div>
                  <div class="large-4 columns selection-label">
                    <h5>
                      <span data-tooltip aria-haspopup="true" class="has-tip" title="Insert tracks and glyphs into the tulip using the placement grid.">
                        Insert into tulip
                      </span>
                    </h5>
                    <div class="row">
                      <div class="large-6 columns">
                        <span data-tooltip aria-haspopup="true" class="has-tip" title="Click to add tracks to the tulip radiating from the center in the selected direction using the placement grid.">
                          Tracks
                        </span>
                      </div>
                      <div class="large-6 columns">
                        <div class="switch round tiny">
                          <input id="toggle-insert-track" type="radio" checked name="toggle-insert-type">
                          <label for="toggle-insert-track"></label>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="large-6 columns">
                        <span data-tooltip aria-haspopup="true" class="has-tip" title="Click to add glyphs to the tulip in the selected position using the placement grid.">
                          Glyphs
                        </span>
                      </div>
                      <div class="large-6 columns">
                        <div class="switch round tiny">
                          <input id="toggle-insert-glyph" type="radio" name="toggle-insert-type">
                          <label for="toggle-insert-glyph"></label>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="large-4 column selection-label">
                    <h5>
                      <span data-tooltip aria-haspopup="true" class="has-tip" title="Insert glyphs into the note and modify glyphs and text using the buttons and slider">
                        Waypoint notes
                      </span>
                    </h5>
                    <div class="row">
                      <div class="large-6 columns">
                        <span data-tooltip aria-haspopup="true" class="has-tip" title="Click to add show or hide the CAP heading for this instruction">
                          CAP
                        </span>
                      </div>
                      <div class="large-6 columns">
                        <div class="switch round tiny">
                          <input id="toggle-heading" type="checkbox" name="toggle-heading" data-bind="checked: instructionShowHeading">
                          <label for="toggle-heading"></label>
                        </div>
                      </div>
                    </div>
                  </div>
                  <hr>
                </div>
                <div class="row">
                  <div class="large-4 columns">
                    <ul class="accordion track-selection" data-accordion>
                      <li class="accordion-navigation">
                        <a href="#added-track-tab" class='track-tab-title'>Add as</a>
                        <div id="added-track-tab" class="content active">
                          <a title="off piste" href="#" class="button tiny radius secondary added-track-selector" data-track="offPiste">
                            <img  src="assets/off-piste-added.png">
                          </a>
                          <a title="track" href="#" class="button tiny radius secondary added-track-selector active" data-track="track">
                            <img  src="assets/track-added.png">
                          </a>
                          <a title="road" href="#" class="button tiny radius secondary added-track-selector" data-track="road">
                            <img src="assets/road-added.png">
                          </a>
                          <a title="main road" href="#" class="button tiny radius secondary added-track-selector" data-track="mainRoad">
                            <img src="assets/main-road-added.png">
                          </a>
                          <a title="divided road" href="#" class="button tiny radius secondary added-track-selector" data-track="dcw">
                            <img src="assets/dcw-added.png">
                          </a>
                        </div>
                      </li>
                      <li class="accordion-navigation">
                        <a href="#entry-track-tab" class='track-tab-title'>Enter on</a>
                        <div id="entry-track-tab" class="content">
                          <a title="off piste" href="#" class="button tiny radius secondary entry-track-selector" data-track="offPiste">
                            <img  src="assets/off-piste-entry.png">
                          </a>
                          <a title="track" href="#" class="button tiny radius secondary entry-track-selector" data-track="track">
                            <img  src="assets/track-entry.png">
                          </a>
                          <a title="road" href="#" class="button tiny radius secondary entry-track-selector" data-track="road">
                            <img src="assets/road-entry.png">
                          </a>
                          <a title="main road" href="#" class="button tiny radius secondary entry-track-selector" data-track="mainRoad">
                            <img src="assets/main-road-entry.png">
                          </a>
                          <a title="divided road" href="#" class="button tiny radius secondary entry-track-selector" data-track="dcw">
                            <img src="assets/dcw-entry.png">
                          </a>
                        </div>
                      </li>
                      <li class="accordion-navigation">
                        <a href="#exit-track-tab" class='track-tab-title'>Exit on</a>
                        <div id="exit-track-tab" class="content">
                          <a title="off piste" href="#" class="button tiny radius secondary exit-track-selector" data-track="offPiste">
                            <img  src="assets/off-piste-exit.png">
                          </a>
                          <a title="track" href="#" class="button tiny radius secondary exit-track-selector" data-track="track">
                            <img  src="assets/track-exit.png">
                          </a>
                          <a title="road" href="#" class="button tiny radius secondary exit-track-selector" data-track="road">
                            <img src="assets/road-exit.png">
                          </a>
                          <a title="main road" href="#" class="button tiny radius secondary exit-track-selector" data-track="mainRoad">
                            <img src="assets/main-road-exit.png">
                          </a>
                          <a title="divided road" href="#" class="button tiny radius secondary exit-track-selector" data-track="dcw">
                            <img src="assets/dcw-exit.png">
                          </a>
                        </div>
                      </li>
                    </ul>
                  </div>
                  <div class="left large-4 columns">
                    <div class="glyph-selection hidden">
                      <div class="tl glyph-grid" data-top="30" data-left="30"><i class="fi-plus"></i></div>
                      <div class="tm glyph-grid" data-top="30" data-left="85"><i class="fi-plus"></i></div>
                      <div class="tr glyph-grid" data-top="30" data-left="145"><i class="fi-plus"></i></div>

                      <div class="ml glyph-grid" data-top="95" data-left="30"><i class="fi-plus"></i></div>
                      <div class="mm glyph-grid undo"><i class="fi-refresh"></i></div>
                      <div class="mr glyph-grid" data-top="95" data-left="145"><i class="fi-plus"></i></div>

                      <div class="ll glyph-grid" data-top="140" data-left="30"><i class="fi-plus"></i></div>
                      <div class="lm glyph-grid" data-top="140" data-left="85"><i class="fi-plus"></i></div>
                      <div class="lr glyph-grid" data-top="140" data-left="145"><i class="fi-plus"></i></div>
                    </div>
                    <div class="track-selection">
                      <div class="tl track-grid" data-angle="-45"><div><i class="fi-arrow-up"></i></div></div>
                      <div class="tm track-grid" data-angle="0"><i class="fi-arrow-up"></i></div>
                      <div class="tr track-grid" data-angle="45"><div><i class="fi-arrow-up"></i></div></div>

                      <div class="ml track-grid" data-angle="-90"><i class="fi-arrow-left"></i></div>
                      <div class="mm track-grid undo"><i class="fi-refresh"></i></div>
                      <div class="mr track-grid" data-angle="90"><i class="fi-arrow-right"></i></div>

                      <div class="ll track-grid" data-angle="-135"><div><i class="fi-arrow-down"></i></div></div>
                      <div class="lm track-grid"data-angle="180"><i class="fi-arrow-down"></i></div>
                      <div class="lr track-grid" data-angle="135"><div><i class="fi-arrow-down"></i></div></div>
                    </div>
                  </div>
                  <div class="left large-4 columns note-tools">
                    <!--
                      START This gets repositioned over the waypoint note in edit mode
                    -->
                    <div id="note-editor-container">
                      <div id="note-editor" contenteditable="true">
                      </div>
                    </div>
                    <!--
                       END This gets repositioned over the waypoint note in edit mode
                    -->
                    <div class="row">
                      <div class="left large-12 columns note-glyph-selection">
                        <span data-tooltip aria-haspopup="true" class="has-tip" title="Click to add glyphs to the end of the note.">
                          Insert glyph
                        </span>
                        <div id="add-glyph-to-note" data-target="add"><i class="fi-plus"></i></i></div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="left large-12 columns">
                        <span data-tooltip aria-haspopup="true" class="has-tip" title="Use the slider to resize selected glyhs and text. Click the style buttons to restyle selected text.">
                          Modify selection
                        </span>
                        <input type="range" min="3" max="6" value="4" id="note-selection-size-range" style="margin-top:10px;width:100%;" list="note-glyph-sizes">
                        <datalist id="note-glyph-sizes">
                        	<option>3</option>
                        	<option>4</option>
                        	<option>5</option>
                        	<option>6</option>
                        </datalist>

                        <button id="note-selection-bold" class="tiny secondary"><i class="fi-bold"></i></button>
                        <button id="note-selection-italic" class="tiny secondary "><i class="fi-italic"></i></button>
                        <button id="note-selection-underline" class="tiny secondary"><i class="fi-underline"></i></button>
                      </div>
                    </div>
                    <div class="row hidden" id="notification-options"  >
                      <div class="left large-12 columns">
                        <span data-tooltip aria-haspopup="true" class="has-tip" title="Change the waypoint bubble radius and modifier.">
                          Waypoint options
                        </span>
                        <br>
                        <!-- <a href="#" id="show-notification-options" class="button tiny secondary radius" data-reveal-id="notification-modal"><i class="fi-target-two"></i></a> -->
                        <div>
                          <div class="row collapse">
                            <div class="large-6 columns">
                              <span data-tooltip aria-haspopup="true" class="has-tip prefix" title="Waypoint bubble radius for RallyComp or RallyBlitz. Please be sure the device your riders are using is compatible with adjustable waypoints.">
                                bubble:
                              </span>
                            </div>
                            <div class="large-6 columns">
                              <input type="number" id="notification-bubble" min="50" max="800" step="50">
                            </div>
                          </div>
                          <div class="row collapse">
                            <div class="large-6 columns">
                              <span data-tooltip aria-haspopup="true" class="has-tip prefix" title="Waypoint modifier for RallyComp or RallyBlitz waypoints, please refer to their documentation for the effects of using this modifier on a particular type of waypoint.">
                                modifier:
                              </span>
                            </div>
                            <div class="large-6 columns">
                              <input type="number" id="notification-modifier">
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--  END CONTENT -->
    </main>
  </body>
  <!--
    Define templates
  -->
  <!--  instruction template-->
  <script type="text/html" id="waypoint-template">
    <div class='waypoint row'>
      <div class='waypoint-distance'>
        <div class='total-distance'>
          <div data-bind="text: totalDistance">
          </div>
        </div>
        <div class="instruction-number">
          <div data-bind="text: instructionNumber()">
          </div>
        </div>
        <div class="relative-distance">
          <div data-bind="text: distFromPrev">
          </div>
        </div>
      </div>
      <div class='waypoint-tulip'>
        <canvas data-bind="instructionCanvasRendered" width='180' height='180'>
        </canvas>
      </div>
      <div class='waypoint-note'>
        <p data-bind="html: noteHTML"></p>
        <div class='heading' data-bind="visible: showHeading">
          <label>CAP </label><span data-bind="text: heading"></span>
        </div>
      </div>
    </div>
  </script>
  <!--
    Glyph Modal
  -->
  <script type="text/html" id="glyph-template">
    <li><a class="th" href="#"><img class="glyph" data-bind="attr: {src: path}"></a><p data-bind="text: name.replace('.svg', '')"></p></li>
  </script>
  <div id="glyphs" class="reveal-modal glyph-modal" data-reveal aria-hidden="true" role="dialog">
    <h3>Choose from the options below to place a glyph: <a class="close-reveal-modal" aria-label="Close">&#215;</a></h3>
    <hr>
    <input id="glyph-search" placeholder="Search for a gylph"></input>
    <i class="fi-x" id="glyph-search-clear"></i>
    <ul id="glyph-search-results" class="small-block-grid-5">
    </ul>
    <ul class="accordion" data-accordion>
      <li class="accordion-navigation">
        <a href="#detail-glyphs">Route Details</a>
        <div id="detail-glyphs" class="content">
          <ul class="tabs" data-tab>
            <li class="tab-title active"><a href="#description-detail">Descriptions</a></li>
            <li class="tab-title"><a href="#condition-detail">Conditions</a></li>
            <li class="tab-title"><a href="#action-detail">Actions</a></li>
          </ul>

          <div class="tabs-content">
            <div class="content active" id="description-detail">
              <ul class="small-block-grid-5" data-bind="template: { name: 'glyph-template', foreach: app.glyphModel.routeDetails.descriptions }"></ul>
            </div>

            <div class="content" id="condition-detail">
              <ul class="small-block-grid-5" data-bind="template: { name: 'glyph-template', foreach: app.glyphModel.routeDetails.conditions }"></ul>
            </div>
            <div class="content" id="action-detail">
              <ul class="small-block-grid-5" data-bind="template: { name: 'glyph-template', foreach: app.glyphModel.routeDetails.actions }"></ul>
            </div>
          </div>
        </div>
      </li>
      <li class="accordion-navigation">
        <a href="#track-glyphs">Track Descriptions</a>
        <div id="track-glyphs" class="content">
          <ul class="small-block-grid-5" data-bind="template: { name: 'glyph-template', foreach: app.glyphModel.trackDescriptions }"></ul>
        </div>
      </li>
      <li class="accordion-navigation">
        <a href="#feature-glyphs">Terrain Features</a>
        <div id="feature-glyphs" class="content">
          <ul class="tabs" data-tab>
            <li class="tab-title active"><a href="#man-made-feature">Man Made</a></li>
            <li class="tab-title"><a href="#natural-feature">Natural</a></li>
            <li class="tab-title"><a href="#symbols-feature">Symbols</a></li>
          </ul>
          <div class="tabs-content">
            <div class="content active" id="man-made-feature">
              <ul class="small-block-grid-5" data-bind="template: { name: 'glyph-template', foreach: app.glyphModel.terrainFeatures.manMade }"></ul>
            </div>
            <div class="content" id="natural-feature">
              <ul class="small-block-grid-5" data-bind="template: { name: 'glyph-template', foreach: app.glyphModel.terrainFeatures.natural }"></ul>
            </div>
            <div class="content" id="symbols-feature">
              <ul class="small-block-grid-5" data-bind="template: { name: 'glyph-template', foreach: app.glyphModel.terrainFeatures.symbols }"></ul>
            </div>
          </div>
        </div>
      </li>
      <li class="accordion-navigation">
        <a href="#orga-glyphs">Orga</a>
        <div id="orga-glyphs" class="content">
          <ul class="tabs" data-tab>
            <li class="tab-title active"><a href="#orga-notices">Notices</a></li>
            <li class="tab-title"><a href="#speed-zones">Speed Zones</a></li>
          </ul>
          <div class="tabs-content">
            <div class="content active" id="orga-notices">
              <ul class="small-block-grid-5" data-bind="template: { name: 'glyph-template', foreach: app.glyphModel.orga.notices }"></ul>
            </div>
            <div class="content" id="speed-zones">
              <ul class="small-block-grid-5" data-bind="template: { name: 'glyph-template', foreach: app.glyphModel.orga.speedZones }"></ul>
            </div>
          </div>
        </div>
      </li>
    </ul>
  </div>

  <script>
    //Jquery sees it is running in CommonJS env, and wants to be used as such.
    window.$ = window.jQuery = require('./assets/libs/jquery-2.1.4.min.js');
  </script>
  <!--
    Load the rest of our libraries
  -->
  <script src="assets/libs/jsclass/dist/browser/js.class.min.js"></script>
  <script src="assets/libs/knockout-3.4.0.js"></script>
  <script src='assets/libs/fabric.min.js'></script>
  <script src='assets/libs/simplify.js'></script>
  <script src='assets/libs/quill/quill.min.js'></script>
  <script src='assets/libs/foundation-5.5.3/js/foundation.min.js'></script>
  <script src='assets/libs/foundation-5.5.3/js/foundation/foundation.tooltip.js'></script>
  <script src='assets/libs/foundation-5.5.3/js/vendor/modernizr.js'></script>
  <!--
    Load the application
  -->
  <script src='src/application.js'></script>
  <script src='api_keys.js'></script>
  <!--
    Load Modules
  -->
  <script src='src/modules/map-viewport-optimizer.js'></script>
  <script src='src/modules/track-editors.js'></script>
  <script src='src/modules/track-remover.js'></script>
  <script src='src/modules/glyph-remover.js'></script>
  <script src='src/modules/io.js'></script>
  <!--
    Load Controllers
  -->
  <script src='src/controllers/map-controller.js'></script>
  <script src='src/controllers/roadbook-controller.js'></script>
  <script src='src/controllers/glyph-modal-controller.js'></script>
  <script src='src/controllers/tulip-palette-controller.js'></script>
  <script src='src/controllers/note-palette-controller.js'></script>
  <!--
    Load Models
  -->
  <script src='src/models/map-model.js'></script>
  <script src='src/models/roadbook-model.js'></script>
  <script src='src/models/glyph-model.js'></script>
  <script src='src/modules/tracks.js'></script>
  <script src='src/modules/tulip.js'></script>
  <script src='src/modules/notification.js'></script>
  <script src='src/modules/instruction.js'></script>
  <script>
  /*
    ---------------------------------------------------------------------------
    Instantiate the application
    ---------------------------------------------------------------------------
  */
  $(document).ready(function(){
    app = new App();
    ko.applyBindings(app.roadbook);
    $(document).foundation();

    new function(){
      var s = document.createElement( 'script' );
      s.setAttribute( 'src', "https://maps.googleapis.com/maps/api/js?key=" + api_keys.google_maps + "&callback=app.initMap" );
      document.body.appendChild( s );
    }

    function setMapSize(){
      var width = window.innerWidth;
      var height = window.innerHeight;
      var hypotenuse = Math.sqrt(Math.pow(width,2)+Math.pow(height,2));

      $('#map').css('height', hypotenuse);
      $('#map').css('width', hypotenuse);
      $('#map').css('left', (width/2)-(hypotenuse/2));
      $('#map').css('top', (height/2)-(hypotenuse/2));
    }
    setMapSize();
    $(window).resize(function(){
      setMapSize();
    })
  });
  </script>
</html>
